<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bob Ross Trading Cards</title>
    <link rel="stylesheet" href="dist.css" />
    <script src="data.js"></script>
    <style>
      /* Card aspect ratio */
      .card-aspect {
        aspect-ratio: 816 / 1110;
      }

      /* Card background */
      .card-back-bg {
        background-image: url("images/bobross-back.png");
        background-size: cover;
        background-position: center;
      }

      /* Drawn card background */
      .card-front-bg {
        background-size: cover;
        background-position: center;
      }
    </style>
  </head>
  <body class="bg-gray-100 min-h-screen flex flex-col p-4">
    <!-- Header -->
    <div class="flex flex-col items-center mb-4 md:flex-row md:justify-between md:items-start">
      <a href="https://justinpoliachik.com" class="text-gray-500 text-sm hover:text-gray-700 mb-2 md:mb-0">
        ‚Üê justinpoliachik.com
      </a>
      <div class="text-gray-500 text-sm text-center">
        I made these to give out at a music festival lol - had to share üòÇ
      </div>
    </div>

    <!-- Game Area -->
    <div class="flex-1 flex flex-col md:flex-row md:items-center md:justify-center gap-8">
      <!-- Deck (Left on desktop, top on mobile) -->
      <div id="deckStack" onclick="drawCard()" class="cursor-pointer mx-auto md:mx-0">
        <div class="relative w-32 h-44 md:w-[400px] md:h-[544px]">
          <!-- Cards will be added here by JS -->
        </div>
      </div>

      <!-- Drawn Cards (Right on desktop, bottom on mobile) -->
      <div id="drawnStack" class="w-full max-w-[450px] md:max-w-[400px] mx-auto md:mx-0">
        <div class="relative w-full card-aspect">
          <!-- Drawn cards will be added here by JS -->
        </div>
      </div>
    </div>

    <script>
      let deck = [];
      let currentCardIndex = 0;

      // Initialize deck
      function initializeDeck() {
        deck = [...cardsData];
        shuffleDeck();
        currentCardIndex = 0;

        // Clear drawn cards
        document.getElementById("drawnStack").querySelector(".relative").innerHTML = "";

        // Restore deck onclick
        const deckStack = document.getElementById("deckStack");
        deckStack.onclick = drawCard;
        deckStack.classList.add("cursor-pointer");

        updateDeckDisplay();
      }

      // Shuffle the deck
      function shuffleDeck() {
        for (let i = deck.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [deck[i], deck[j]] = [deck[j], deck[i]];
        }
      }

      // Update deck visual
      function updateDeckDisplay() {
        const deckStack = document.getElementById("deckStack").querySelector(".relative");
        const remaining = deck.length - currentCardIndex;

        deckStack.innerHTML = "";

        if (remaining === 0) {
          // Show reset button
          deckStack.innerHTML = `
          <div onclick="initializeDeck()" class="w-full h-full rounded-xl border-4 border-yellow-400 bg-gradient-to-br from-purple-900 to-purple-700 flex items-center justify-center text-white text-4xl hover:scale-105 transition-transform cursor-pointer">
            üîÄ
          </div>
        `;
          document.getElementById("deckStack").onclick = null;
        } else {
          // Show card stack
          const cardsToShow = Math.min(remaining, 10);
          for (let i = 0; i < cardsToShow; i++) {
            const reverseIndex = cardsToShow - 1 - i;
            const cardBack = document.createElement("div");
            cardBack.className = "absolute inset-0 card-back-bg rounded-xl border-4 border-yellow-400";
            cardBack.style.transform = `translate(${reverseIndex * 2}px, ${reverseIndex * 2}px)`;
            cardBack.style.zIndex = i;

            // Add shadow to top card
            if (i === cardsToShow - 1) {
              cardBack.classList.add(remaining > 5 ? "shadow-2xl" : "shadow-lg");
            }

            deckStack.appendChild(cardBack);
          }

          // Add hover effect to top card
          const topCard = deckStack.lastElementChild;
          if (topCard) {
            topCard.classList.add("hover:translate-x-[-2px]", "hover:translate-y-[-2px]", "transition-transform");
          }
        }
      }

      // Update drawn stack
      function updateDrawnStack() {
        const drawnStack = document.getElementById("drawnStack").querySelector(".relative");
        drawnStack.innerHTML = "";

        if (currentCardIndex === 0) return;

        // Show only the most recent card on mobile, stack on desktop
        const isMobile = window.innerWidth < 768;
        const cardsToShow = isMobile ? 1 : Math.min(currentCardIndex, 10);
        const startIndex = currentCardIndex - cardsToShow;

        for (let i = startIndex; i < currentCardIndex; i++) {
          const card = deck[i];
          const offset = i - startIndex;
          const cardElement = document.createElement("div");

          // Use exported card images
          const filename = card.name.replace(/[^a-z0-9]/gi, "_").toLowerCase();

          cardElement.className = "absolute inset-0 card-front-bg rounded-xl border-4 border-yellow-400";
          cardElement.style.backgroundImage = `url('card-exports/${filename}.png')`;

          if (!isMobile) {
            cardElement.style.transform = `translate(${offset * 2}px, ${offset * 2}px)`;
            cardElement.style.zIndex = offset;
          }

          drawnStack.appendChild(cardElement);
        }
      }

      // Draw a card
      function drawCard() {
        if (currentCardIndex >= deck.length) return;

        currentCardIndex++;
        updateDeckDisplay();
        updateDrawnStack();
      }

      // Handle resize
      window.addEventListener("resize", () => {
        if (currentCardIndex > 0) {
          updateDrawnStack();
        }
      });

      // Initialize on load
      window.addEventListener("DOMContentLoaded", initializeDeck);
    </script>
  </body>
</html>
